language: node_js
node_js: stable
cache:
  directories:
  - node_modules
before_install:
- npm install -g gitbook-cli
install:
- gitbook install
- gitbook build
test: true
script:
- git checkout --orphan gh-pages
- git rm --cached -r .
- git clean -df
- rm -rf *~
- cp -r _book/* .
- git config user.name "breezetemple"
- git config user.email "breeze.temple@gmail.com"
- git add .
- git commit -m "Publish book"
- git push --force --quiet "https://${GITHUB_TOKEN}@${GH_REF}" master:gh-pages
deploy:
  provider: pages
  skip_cleanup: true
  github_token: $GITHUB_TOKEN  # Set in the settings page of your repository, as a secure variable
  keep_history: true
  on:
    branch: master
env:
  global:
  - GH_REF: github.com/breezetemple/how-to-use-gitbook.git
